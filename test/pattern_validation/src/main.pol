type TestEnum {
    Variant1(value: Int)
    Variant2
    Variant3(first: String, second: Bool)
}

fn list_len(nums: List(Int)) -> Int {
    match nums {
        [] -> 0,
        [_, ...tail] -> 1 + list_len(tail)
    }
}

fn test_basic_matching() -> Int {
    let x = 42
    match #(Variant1(12), x) {
        #(Variant2, 1) -> 10,
        #(Variant3(_, b), 42) -> 100,
        #(Variant3(_, True), c) -> 50,
        _ -> 0
    }
}

fn test_tuple_destructuring() -> Int {
    let pair = #(10, 20)
    match pair {
        #(a, b) -> a + b
    }
}

fn test_option_matching(opt: Option(Int)) -> Int {
    match opt {
        Some(x) -> x * 2,
        None -> -1
    }
}

fn test_nested_matching() -> String {
    let nested = Some(#(True, 42))
    match nested {
        None -> "nothing",
        Some(#(True, x)) -> "true case",
        Some(#(False, x)) -> "false case"
    }
}

fn test_list_patterns() -> Int {
    let numbers = [1, 2, 3, 4]
    let binder_case = match numbers {
        [] -> 0,
        [single] -> single,
        [first, second] -> first + second,
        [first, second, third] -> first + second + third,
        [first, second, ...rest] -> first + second + list_len(rest)
    }

    let shorter = [9, 10, 11]
    let wildcard_case = match shorter {
        [first, ...rest] -> first - list_len(rest),
        [first, second, ...] -> first * second, // unreachable
        _ -> 0
    }

    binder_case + wildcard_case
}

fn test_list_rest_binding(numbers: List(Int)) -> Int {
    match numbers {
        [first, ...rest] -> first + list_len(rest),
        [first, second, ...rest] -> first + second + list_len(rest), // unreachable
        [] -> 0
    }
}

fn test_custom_enum(value: TestEnum) -> String {
    match value {
        Variant1(x) -> "variant1",
        Variant2 -> "variant2",
        Variant3(s, b) -> "variant3"
    }
}

fn main() -> Int {
    let basic = test_basic_matching()
    let tuple_result = test_tuple_destructuring()
    let option_result = test_option_matching(Some(5))
    let list_result = test_list_patterns()
    let list_rest_result = test_list_rest_binding([5, 6, 7])
    let list_rest_single = test_list_rest_binding([8])

    basic + tuple_result + option_result + list_result + list_rest_result + list_rest_single
}
